{{ define "content" }}
<h2>我的任务</h2>

<!-- 添加任务表单 -->
<form method="POST" action="/tasks/create" class="mb-4">
  <div class="input-group">
    <input type="text" name="title" class="form-control" placeholder="输入新任务..." required>
    <button class="btn btn-success" type="submit">添加</button>
  </div>
</form>

<!-- 任务列表 -->
<ul class="list-group">
{{ range .Tasks }}
  <li class="list-group-item d-flex justify-content-between align-items-center">
    <span {{ if .Completed }}style="text-decoration: line-through; color: #6c757d;"{{ end }}>
      {{ .Title }}
    </span>
    <div>
      <!-- 切换完成状态（用简单 JS 实现无刷新） -->
      <button class="btn btn-sm {{ if .Completed }}btn-secondary{{ else }}btn-outline-success{{ end }}"
              onclick="toggleTask('{{ .ID }}')">
        {{ if .Completed }}已完成{{ else }}标记完成{{ end }}
      </button>
      <a href="/tasks/delete/{{ .ID }}" class="btn btn-sm btn-outline-danger ms-2"
         onclick="return confirm('确定删除？')">删除</a>
    </div>
  </li>
{{ else }}
  <li class="list-group-item text-muted">暂无任务</li>
{{ end }}
</ul>

<script>
function toggleTask(id) {
  fetch('/tasks/toggle/' + id, {
    method: 'POST',
    headers: { 'X-Requested-With': 'XMLHttpRequest' }
  })
  .then(res => res.json())
  .then(data => location.reload()); // 简单起见，直接刷新；也可局部更新 DOM
}
</script>
{{ end }}