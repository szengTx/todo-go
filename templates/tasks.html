{{define "title"}}我的任务 - 任务管理系统{{end}}
{{define "content"}}
<h2>我的任务</h2>

<div class="view-switcher">
    <button id="list-view-btn" class="active">列表视图</button>
    <button id="calendar-view-btn">日历视图</button>
</div>


<div id="task-list">
    {{if .error}}
    <p style="color: red;">{{.error}}</p>
    {{end}}

    <form action="/tasks/create" method="post">
        <input type="text" name="title" placeholder="输入新任务..." required>
        <input type="date" name="deadline">
        <button type="submit">添加任务</button>
    </form>

    <ul>
        {{range .Tasks}}
        <li>
            <form action="/tasks/toggle/{{.ID}}" method="post" style="display: inline;">
                <input type="checkbox" {{if .Completed}}checked{{end}} onchange="this.form.submit()">
            </form>
            <span class="task-title {{if .Completed}}completed{{end}}">
                {{.Title}}
            </span>
            {{if .Deadline}}
            <span class="deadline">
                (截止日期: {{.Deadline.Format "2006-01-02"}})
            </span>
            {{end}}
            <a href="/tasks/delete/{{.ID}}">删除</a>
        </li>
        {{end}}
    </ul>
</div>

<div id="calendar-view" style="display: none;">
    <div id="calendar"></div>
</div>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        const listViewBtn = document.getElementById('list-view-btn');
        const calendarViewBtn = document.getElementById('calendar-view-btn');
        const taskListDiv = document.getElementById('task-list');
        const calendarViewDiv = document.getElementById('calendar-view');
        const calendarEl = document.getElementById('calendar');

        let calendar;

        function showListView() {
            taskListDiv.style.display = 'block';
            calendarViewDiv.style.display = 'none';
            listViewBtn.classList.add('active');
            calendarViewBtn.classList.remove('active');
        }

        function showCalendarView() {
            taskListDiv.style.display = 'none';
            calendarViewDiv.style.display = 'block';
            listViewBtn.classList.remove('active');
            calendarViewBtn.classList.add('active');

            if (!calendar) {
                calendar = new FullCalendar.Calendar(calendarEl, {
                    initialView: 'dayGridMonth',
                    headerToolbar: {
                        left: 'prev,next today',
                        center: 'title',
                        right: 'dayGridMonth,timeGridWeek,listWeek'
                    },
                    events: '/tasks/json',
                    locale: 'zh-cn'
                });
                calendar.render();
            }
        }

        listViewBtn.addEventListener('click', showListView);
        calendarViewBtn.addEventListener('click', showCalendarView);
    });
</script>

{{end}}

{{define "tasks.html"}}{{template "base" .}}{{end}}